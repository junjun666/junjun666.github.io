<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><meta name="author" content="John Doe"><link rel="icon" href="/hexo.png"><title>Hexo</title><meta name="description"><link rel="alternate" type="application/rss+xml" title="Hexo" href="/atom.xml"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/highlight.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class="container-fluid"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#main-navbar" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Hexo</a></div><div id="main-navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/archives">Archive</a></li><li><a href="https://github.com/junjun666/junjun666.github.io">Github</a></li><li><a href="/about/">About</a></li></ul></div><div class="avatar-container"><div class="avatar-img-border"><a href="/"><img src="/hexo.png" class="avatar-img"></a></div></div></div></nav><header class="header-section"><div class="intro-header no-img"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="post-heading"><h1>react-ref的属性使用盘点</h1><p class="post-meta">Posted on Jul 28 2019</p></div></div></div></div></div></header><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role="main" class="blog-post"><h2 id="1-ref的简述"><a href="#1-ref的简述" class="headerlink" title="1:ref的简述"></a>1:ref的简述</h2><p>官方文档：在从 render 方法中返回 UI 结构之后，你可能想冲出 React 虚拟 DOM 的限制，在 render 返回的组件实例上调用某些方法。通常来说，这样做对于应用中的数据流动是不必要的，因为活跃的数据（ Reactive data ）流总是确保最新的 props 被传递到每一个从 render() 输出的子级中去。然而，仍然有几个场景使用这种方式是必须的，或者说是有益的：查找渲染出的组件的DOM标记（可以认为是DOM的标识ID），在一个大型的非React应用中使用React组件或者是将你现有的代码转化成React。</p>
<p>总结下来：ref属性其实就是为了获取DOM节点</p>
<h2 id="2-实战用法"><a href="#2-实战用法" class="headerlink" title="2:实战用法"></a>2:实战用法</h2><h3 id="一：给html的标签添加："><a href="#一：给html的标签添加：" class="headerlink" title="一：给html的标签添加："></a>一：给html的标签添加：</h3><p>question:什么时候回调函数会被被调用呢？<br>答：当组件挂载后和卸载后，以及ref属性本身发生变化时，回调函数就会被调用。</p>
<p>先举一个通俗易懂的小例子：我们已经把input元素存储在了this.textInput中，在focus函数中直接使用原生DOM API实现focus聚焦。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class Input extends Component &#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super(props);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    focus = () =&gt; &#123;</span><br><span class="line">        this.textInput.focus();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;input ref=&#123;(input) =&gt; &#123; this.textInput = input &#125;&#125; /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="实际开发中"><a href="#实际开发中" class="headerlink" title="实际开发中:"></a>实际开发中:</h4><p>1)用在input标签上的用法，这里的c值是当前的dom节点，field值是传入的phone值或者smsCode值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">forceUpdater = field =&gt; (c) =&gt; &#123;</span><br><span class="line">    if (c) &#123;</span><br><span class="line">      c.value = this.state[field]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;input type=&apos;text&apos; placeholder=&apos;请输入手机号&apos; ref=&#123;this.forceUpdater(&apos;phone&apos;)&#125; default=&#123;phone&#125; data-field=&apos;phone&apos; onBlur=&#123;this.handleInputChange&#125; /&gt;</span><br><span class="line">&lt;input type=&apos;text&apos; placeholder=&apos;短信验证码&apos; ref=&#123;this.forceUpdater(&apos;smsCode&apos;)&#125; default=&#123;smsCode&#125; data-field=&apos;smsCode&apos; onBlur=&#123;this.handleInputChange&#125; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>2)用在某一个标签上，获取整个dom节点。<br>这里的this.node为整个dom节点，el为dom节点的最后一个子元素。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount() &#123;</span><br><span class="line">    this.setPosition();</span><br><span class="line">&#125;</span><br><span class="line">setPosition() &#123;</span><br><span class="line">    const el = this.node.lastChild;</span><br><span class="line">    if (!el) return;</span><br><span class="line"></span><br><span class="line">    const left = (window.innerWidth - el.offsetWidth) / 2;</span><br><span class="line">    const top = (window.innerHeight - el.offsetHeight) / 2;</span><br><span class="line"></span><br><span class="line">    this.setState(&#123; top, left &#125;);</span><br><span class="line">&#125;</span><br><span class="line">&lt;div className=&#123;cls&#125; ref=&#123;node =&gt; (this.node = node)&#125;&gt;</span><br><span class="line">      &#123;props.modal ? &lt;div className=&quot;smartui_mask&quot; style=&#123;props.maskStyle &amp;&amp; &#123;backgroundColor: &apos;black&apos;&#125;&#125; onClick=&#123;props.modalClose ? this.close : &apos;&apos;&#125; /&gt; : null&#125;</span><br><span class="line">      &lt;div className=&quot;smartui-layer-content&quot; style=&#123;styleObj&#125;&gt;</span><br><span class="line">        &lt;div className=&quot;smartui-layer-header&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=&quot;smartui-layer-body&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="二：给组件添加。"><a href="#二：给组件添加。" class="headerlink" title="二：给组件添加。"></a>二：给组件添加。</h3><p>这里的startCounter方法是在Counter组件中定义的方法。注意：<counter>组件必须是使用class声明的组件，不然无法使用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">if (res.code === 0) &#123;</span><br><span class="line">    this.changeErrorMsg(&apos;验证码已发往你的手机，请注意查收&apos;)</span><br><span class="line">    if (this.counter) &#123;</span><br><span class="line">        this.counter.startCounter()</span><br><span class="line">    &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        this.changeErrorMsg(res.msg !== &apos;未知错误&apos; ? res.msg : &apos;网络繁忙，请稍后重试&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123; status === 2 &amp;&amp; &lt;div className=&apos;row row-smscode&apos;&gt;</span><br><span class="line">    &lt;input type=&apos;text&apos; placeholder=&apos;短信验证码&apos; ref=&#123;this.forceUpdater(&apos;smsCode&apos;)&#125; default=&#123;smsCode&#125; data-field=&apos;smsCode&apos; onBlur=&#123;this.handleInputChange&#125; /&gt;</span><br><span class="line">    &lt;Counter ref=&#123;(c) =&gt; &#123; if (c) &#123; this.counter = c &#125; &#125;&#125; onClick=&#123;this.checkSendSmsCode&#125; /&gt;</span><br><span class="line">&lt;/div&gt;&#125;</span><br></pre></td></tr></table></figure></counter></p>
<h3 id="三：不能在无状态组件中使用ref。"><a href="#三：不能在无状态组件中使用ref。" class="headerlink" title="三：不能在无状态组件中使用ref。"></a>三：不能在无状态组件中使用ref。</h3><p>原因很简单，因为ref引用的是组件的实例，而无状态组件准确的说是个函数组件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function MyFunctionalComponent() &#123;</span><br><span class="line">    return &lt;input /&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Parent extends React.Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;MyFunctionalComponent</span><br><span class="line">                ref=&#123;(input) =&gt; &#123; this.textInput = input; &#125;&#125; /&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面的代码是无法正常工作的。<br>参考资料：<a href="https://www.jianshu.com/p/6868174b0b34" target="_blank" rel="noopener">React ref属性使用</a></p>
</article><ul class="pager blog-pager"><li class="previous"><a href="/2019/08/04/ts-database/" data-toggle="tooltip" data-placement="top" title="typescript操作数据库的样例">← Artículo anterior</a></li><li class="next"><a href="/2019/07/21/react-loadable/" data-toggle="tooltip" data-placement="top" title="react-loadable原理剖析和实战用法">Artículo siguiente →</a></li></ul><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div><script src="//img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"> </script><script>var cloudTieConfig = {
  url: document.location.href, 
  sourceId: "",
  productKey: "64d7f0abf9224be3bfdcc6cfb9b83fcf",
  target: "cloud-tie-wrapper"
};</script></div></div></div><footer><div class="container beautiful-jekyll-footer"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href="" title="Weibo"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-weibo"></i></span></a></li><li><a href="https://github.com/junjun666" title="GitHub"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-github"></i></span></a></li><li><a href="/atom.xml" title="RSS"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-rss"></i></span></a></li><li><a href="" title="Twitter"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-twitter"></i></span></a></li><li><a href="" title="Email me"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-envelope"></i></span></a></li></ul><p class="copyright text-muted">© John Doe • 2019 • <a href="mailto:undefined"></a>
</p><p class="theme-by text-muted">Theme by
<a href="https://github.com/twoyao/beautiful-hexo">beautiful-hexo</a></p></div></div></div></footer><script src="//cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script><script src="//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/js/main.js"></script><script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>